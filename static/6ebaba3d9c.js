define(function(e){function t(e){e=e.toLowerCase();if(e.length===0)return[];if(e.length<3)return[e];var t=[];for(var n=0;n<=e.length-3;n+=1)t.push(e.substr(n,3));return t}function n(){this.trigramTable={},this.resultIndex=[]}return n.prototype.addTerm=function(e,n){var r={};this.resultIndex.push(n);for(var i=0;i<e.length;i+=1){var r=t(e[i]);for(var s=0;s<r.length;s+=1){var o=r[s];o in this.trigramTable||(this.trigramTable[o]=[]),this.trigramTable[o].push(this.resultIndex.length-1)}}},n.prototype.search=function(e,n){var r=this,i=e.toLowerCase().split(" "),n=n||300,s=[],o={};i.forEach(function(e,n){s=s.concat(t(e))}),s.forEach(function(e){if(e in r.trigramTable){var t=r.trigramTable[e];for(var n=0;n<t.length;n+=1){var i=t[n];o[i]=o[i]||0,o[i]=o[i]+1}}});var u=[];for(var a in o)u.push({code:a,score:o[a]});return u.length>0?u.map(function(e){return r.resultIndex[e.code]}):[]},n}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),function(){function e(e){var t=e.match(/^\\u([\dABCDEFabcdef]{4})$/),n=e.match(/^&#(\d+);$/)||e.match(/^(\d+)$/),r=undefined;return t?r=parseInt(t[1],16):n?r=n[1]:e.length===1&&(r=e.charCodeAt(0)),r}function t(e){return Math.floor((e-65536)/1024)+55296}function n(e){return(e-65536)%1024+56320}function r(e){if(e<=65535)return"\\u"+(e+65536).toString(16).substr(-4).toUpperCase();throw"Code point outside BMP cannot be encoded."}function i(e){return e<=65535?r(e):r(t(e))+r(n(e))}var s=function(e,t){var n={},r=e.getElementsByTagName(t)[0];return function(i,s){var o;typeof n[i]=="undefined"?(o=e.createElement(t),o.async=!0,o.src=i,s&&(o.onload=function(){o.onloadDone||(o.onloadDone=!0,s())},o.onreadystatechange=function(){(o.readyState==="loaded"||o.readyState==="complete")&&o.onload()}),r.parentNode.insertBefore(o,r),n[i]=o):s&&s()}}(document,"script");document.getElementById("searchField").focus(),document.forms[0].onsubmit=function(){return!1},_gaq=window._gaq||[],_gaq.push(["_setAccount","UA-33198175-1"]),_gaq.push(["_setDomainName","charcod.es"]),_gaq.push(["_trackPageview"]),s(("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js"),s("http://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js",function(){function o(e){_gaq.push(["_trackEvent","search",undefined,e]);var r=[],i=e.match(/^\\u(\d{4})$/),s=e.match(/^&#(\d+);$/)||e.match(/^(\d+)$/);i?r=[parseInt(i[1],16)]:s?r=[s[1]]:r=search(e),e.length===1&&r.length===0&&(r=[e.charCodeAt(0)]),r.length===0?$("#help").show():$("#help").hide(),$("#results").html($.map(r,function(e){var n=t[e]&&t[e].n.indexOf("combining")!==-1,r=(n?"&#9676;":"")+"&#"+e+";";return'<a href="#id'+e+'" id="id'+e+'">'+r+"</a>"}).join("")),r.length===1&&n.activate($("#results a").first())}function u(){if(!location.hash)return;var t=location.hash.split("#")[1],r=t.match(/^([^\/]+)\/(.*)$/),i=e(t),u=undefined,a=undefined;r?(u=r[1],a=r[2]):i?u=a=i:(u=t,a=undefined),a&&u===undefined&&(u=a),s.val(u),o(u);if(a){var f=$("#id"+a).first();f&&n.activate(f)}}var t={},n=function(){var e,n,r=function(e){var n=t[e],r=$(".templates .charInfo").clone(),s=t[e]&&t[e].n.indexOf("combining")!==-1,o=["&amp;#"+e+";"],u=$("#searchField").val(),a=u+"/"+e,f=e;return u===e&&(a=e),location.hash="#"+a,r.find("h2").html((s?"&#9676;":"")+"&#"+e+";"),r.find(".permalink").attr("href","#"+f),r.find(".char-source").html(i(parseInt(e,10))),r.find(".char-codepoint").html(e),n&&(r.find("h3").html(n.n),r.find(".char-group").attr("href","#"+n.b).html(n.b),n.a&&n.a.length>0&&r.find(".aliases").html(n.a.join(", ")),n.altnames&&n.altnames.html&&o.push("&amp;#"+n.altnames.html+";"),r.find(".char-html").html(o.join("<br>")),_gaq.push(["_trackEvent","popup","activate",n.b]),n.altnames&&n.altnames.latex?r.find(".char-latex").html(n.altnames.latex):r.find(".char-latex-row").hide()),r};return{activate:function(t){var i=t[0].id.replace("id",""),s=t.position().top,o=t;e&&this.deactivate(),e=t,n=r(i);while(o.next().length&&o.next().position().top===s)o=o.next();n.insertAfter(o),e.addClass("active")},deactivate:function(){e.removeClass("active"),n&&n.remove(),e=n=undefined}}}();$("#results").on("click","a",function(e){n.activate($(e.target)),e.preventDefault()});var r,s=$("#searchField");s.keyup(function(e){r&&window.clearTimeout(r),r=window.setTimeout(function(){o(s.val().trim())},250)}),$(".form-search").submit(function(){return o(s.val().trim()),!1}),$.ajax({url:"data.json",dataType:"json",success:function(e){var n=0,r=e.length,i,a;for(;n<r;n+=1){i=e[n],t[i.c]=i,tagsToTrigrams(i.c,i.n.split(" ")),tagsToTrigrams(i.c,[i.b]),i.a&&tagsToTrigrams(i.c,i.a);if(i.altnames)for(a in i.altnames)tagsToTrigrams(i.c,[i.altnames[a]])}s.val()&&o(s.val()),u()},error:function(){throw new Error("could not load data.json: "+arguments)}}),window.onhashchange=function(e){e.newURL!==e.oldURL&&u()},u()})}()