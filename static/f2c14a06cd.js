function wordToTrigrams(a){if(a.length===0)return[];if(a.length<3)return[a];var b=[];for(var c=0;c<=a.length-3;c+=1)b.push(a.substr(c,3));return b}function tagsToTrigrams(a,b){var c=0,d=b.length;for(;c<d;c+=1)tagToTrigrams(a,b[c])}function tagToTrigrams(a,b){var c=wordToTrigrams(b),d=0,e=c.length,f;for(;d<e;d+=1)f=c[d],trigramTable[f]||(trigramTable[f]=[]),trigramTable[f].push(a)}function search(a){var b=a.toLowerCase().split(" "),c=[],d={};$.each(b,function(a,b){c=c.concat(wordToTrigrams(b))}),$.each(c,function(a,b){if(b in trigramTable){var c=trigramTable[b];for(var e=0;e<c.length;e+=1){var f=c[e];d[f]=d[f]||0,d[f]=d[f]+1}}});var e=[];$.each(d,function(a,b){e.push({code:a,score:b})});if(e.length>0){e.sort(function(a,b){return b.score!==a.score?b.score-a.score:a.code-b.code});var f=Math.ceil(e[0].score/2);return e=$.map(e,function(a,b){if(a.score>f||b<300)return a}),$.map(e,function(a){return a.code})}return[]}var trigramTable={};String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),function(){function a(a){var b=a.match(/^\\u([\dABCDEFabcdef]{4})$/),c=a.match(/^&#(\d+);$/)||a.match(/^(\d+)$/),d=undefined;return b?d=parseInt(b[1],16):c?d=c[1]:a.length===1&&(d=a.charCodeAt(0)),d}function b(a){return Math.floor((a-65536)/1024)+55296}function c(a){return(a-65536)%1024+56320}function d(a){if(a<=65535)return"\\u"+(a+65536).toString(16).substr(-4).toUpperCase();throw"Code point outside BMP cannot be encoded."}function e(a){return a<=65535?d(a):d(b(a))+d(c(a))}var f=function(a,b){var c={},d=a.getElementsByTagName(b)[0];return function(e,f){var g;typeof c[e]=="undefined"?(g=a.createElement(b),g.async=!0,g.src=e,f&&(g.onload=function(){g.onloadDone||(g.onloadDone=!0,f())},g.onreadystatechange=function(){(g.readyState==="loaded"||g.readyState==="complete")&&g.onload()}),d.parentNode.insertBefore(g,d),c[e]=g):f&&f()}}(document,"script");document.getElementById("searchField").focus(),document.forms[0].onsubmit=function(){return!1},_gaq=window._gaq||[],_gaq.push(["_setAccount","UA-33198175-1"]),_gaq.push(["_setDomainName","charcod.es"]),_gaq.push(["_trackPageview"]),f(("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js"),f("http://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js",function(){function g(a){_gaq.push(["_trackEvent","search",undefined,a]);var d=[],e=a.match(/^\\u(\d{4})$/),f=a.match(/^&#(\d+);$/)||a.match(/^(\d+)$/);e?d=[parseInt(e[1],16)]:f?d=[f[1]]:d=search(a),a.length===1&&d.length===0&&(d=[a.charCodeAt(0)]),d.length===0?$("#help").show():$("#help").hide(),$("#results").html($.map(d,function(a){var c=b[a]&&b[a].n.indexOf("combining")!==-1,d=(c?"&#9676;":"")+"&#"+a+";";return'<a href="#id'+a+'" id="id'+a+'">'+d+"</a>"}).join("")),d.length===1&&c.activate($("#results a").first())}function h(){if(!location.hash)return;var b=location.hash.split("#")[1],d=b.match(/^([^\/]+)\/(.*)$/),e=a(b),h=undefined,i=undefined;d?(h=d[1],i=d[2]):e?h=i=e:(h=b,i=undefined),i&&h===undefined&&(h=i),console.log("searchTerm",h),console.log("highlight",i),f.val(h),g(h),console.log("#id"+i),console.log($("#id"+i));if(i){var j=$("#id"+i).first();j&&c.activate(j)}}var b={},c=function(){var a,c,d=function(a){var c=b[a],d=$(".templates .charInfo").clone(),f=b[a]&&b[a].n.indexOf("combining")!==-1,g=["&amp;#"+a+";"],h=location.href.replace(/(#.*)?$/,"#"+a);return d.find("h2").html((f?"&#9676;":"")+"&#"+a+";"),d.find(".permalink").attr("href",h).html(h),d.find(".char-source").html(e(parseInt(a,10))),d.find(".char-codepoint").html(a),c&&(d.find("h3").html(c.n),d.find(".char-group").html(c.b),c.a&&c.a.length>0&&d.find(".aliases").html(c.a.join(", ")),c.altnames&&c.altnames.html&&g.push("&amp;#"+c.altnames.html+";"),d.find(".char-html").html(g.join("<br>")),_gaq.push(["_trackEvent","popup","activate",c.b]),c.altnames&&c.altnames.latex?d.find(".char-latex").html(c.altnames.latex):d.find(".char-latex-row").hide()),d};return{activate:function(b){var e=b[0].id.replace("id",""),f=b.position().top,g=b;a&&this.deactivate(),a=b,c=d(e);while(g.next().length&&g.next().position().top===f)g=g.next();c.insertAfter(g),a.addClass("active");var h=$("#searchField").val();h===e?location.hash=h:location.hash=h+"/"+e},deactivate:function(){a.removeClass("active"),c.remove(),a=c=undefined}}}();$("#results").on("click","a",function(a){c.activate($(a.target)),a.preventDefault()});var d,f=$("#searchField");f.keyup(function(a){d&&window.clearTimeout(d),d=window.setTimeout(function(){g(f.val().trim())},250)}),$(".form-search").submit(function(){return g(f.val().trim()),!1}),$.ajax({url:"data.json",dataType:"json",success:function(a){var c=0,d=a.length,e,i;for(;c<d;c+=1){e=a[c],b[e.c]=e,tagsToTrigrams(e.c,e.n.split(" ")),tagsToTrigrams(e.c,[e.b]),e.a&&tagsToTrigrams(e.c,e.a);if(e.altnames)for(i in e.altnames)tagsToTrigrams(e.c,[e.altnames[i]])}f.val()&&g(f.val()),h()},error:function(){throw new Error("could not load data.json: "+arguments)}}),h()})}()